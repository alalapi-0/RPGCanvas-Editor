# RPGCanvas Editor

## 项目简介
RPGCanvas Editor 是一个基于原生 HTML5 Canvas 的 RPG Maker 风格 2D 地图编辑器。项目遵循“纯前端、零依赖”的设计理念，强调可维护的模块化结构，预计在多轮迭代中逐步完善地图绘制、素材管理与导入导出等功能。

## 当前目标
- **R1**：搭建最小可运行页面框架，完成布局、模块占位与初始化日志。
- **R2**：实现网格绘制与基础相机系统，支持平移、缩放及状态栏反馈。

## R2 新增说明：网格、相机平移、缩放
- Canvas 采用脏渲染循环，仅在状态改变时重新绘制，提高性能。
- 渲染器内置 48×48 的网格绘制逻辑，可通过工具栏按钮即时开关。
- 相机支持鼠标中键拖动与空格+左键拖动进行平移；滚轮实现 0.5–2.0 范围的缩放，并保持鼠标位置为缩放锚点。
- 状态栏实时显示缩放百分比与鼠标在画布内的屏幕坐标，便于后续扩展世界坐标信息。

## 使用说明
1. 打开 `index.html` 即可启动编辑器，无需任何构建工具或第三方依赖。
2. 鼠标滚轮控制缩放，范围限制在 0.5–2.0；缩放时以指针所在点为锚点。
3. 按住鼠标中键拖动即可平移视图；亦可按住空格再用左键拖动完成平移。
4. 工具栏新增 `Grid` 按钮，可切换网格显示与否。
5. 状态栏字段：
   - `缩放`：展示当前缩放百分比（取整）。
   - `坐标`：展示鼠标在画布内的屏幕坐标；鼠标移出后恢复 `-`。

## 技术要点
- **相机与坐标换算公式**：
  - 屏幕转世界：`worldX = camera.x + screenX / camera.zoom`，`worldY = camera.y + screenY / camera.zoom`。
  - 世界转屏幕：`screenX = (worldX - camera.x) * camera.zoom`，`screenY = (worldY - camera.y) * camera.zoom`。
- **以鼠标为锚点的缩放**：
  - 在缩放前记录锚点的世界坐标 `anchorWorld`；缩放后重置相机为 `camera.x = anchorWorld.x - anchorScreenX / zoom`（Y 同理），确保锚点仍落在原屏幕位置。
- **脏渲染策略**：
  - 渲染器维护 `needsRender` 标记，仅在相机平移、缩放、尺寸变化或网格开关变化时触发 `render()`，通过 `requestAnimationFrame` 循环判断是否需要重绘。

## 目录结构
```
/ (项目根目录)
├─ index.html              # 页面入口，定义布局与脚本加载顺序
├─ css/
│  └─ styles.css           # 全局主题变量、布局与组件样式
├─ js/
│  ├─ main.js              # 应用入口，组织初始化流程与全局事件
│  ├─ renderer.js          # 渲染器，实现网格、相机与脏渲染循环
│  ├─ editor.js            # 编辑器状态，记录图层及交互标记
│  ├─ ui.js                # UI 交互逻辑，绑定工具栏与相机控制
│  └─ io.js                # 导入导出占位函数，仅输出日志
├─ assets/
│  └─ manifest.json        # 素材清单占位，记录 tileSize 与版本
├─ data/
│  └─ .keep                # 占位文件，保持目录以存放后续示例数据
└─ README.md               # 项目文档（本文件）
```

## 运行方式
1. 直接双击 `index.html`，使用现代浏览器（推荐 Chrome / Edge）打开即可预览。
2. 若浏览器策略限制本地文件访问，可使用 VSCode Live Server 或任意静态服务器启动根目录。
3. 打开浏览器开发者工具，可在控制台看到启动日志与相机就绪提示，验证功能是否正常。

## 本轮验收清单
- [x] 打开 `index.html`，默认显示网格背景。
- [x] 鼠标滚轮缩放范围为 0.5–2.0，并以鼠标位置为缩放锚点。
- [x] 鼠标中键拖动或按住空格+左键拖动均可平移视图。
- [x] 工具栏 `Grid` 按钮可即时切换网格显示。
- [x] 状态栏缩放百分比与鼠标屏幕坐标随交互更新。
- [x] 浏览器窗口缩放后 Canvas 自适应父容器并保持交互正常。
- [x] 控制台打印 `[RPGCanvas] R2 camera+grid ready` 且无错误或未处理异常。
- [x] 所有 JavaScript 文件保持逐行中文注释，无语法警告。

## 后续路线图（第 3 ~ 15 轮概述）
- **第 3 轮**：实现基础地图数据结构与新建地图对话流程。
- **第 4 轮**：完成素材加载与缩略图渲染，占位资产替换为真实 PNG。
- **第 5 轮**：加入网格绘制优化与相机交互增强（惯性、限制边界等）。
- **第 6 轮**：实现图层可见性控制与图层排序面板。
- **第 7 轮**：添加基础绘制工具（画笔/橡皮擦）与撤销重做系统。
- **第 8 轮**：完善状态栏信息，显示地图尺寸、图层与光标世界坐标。
- **第 9 轮**：实现素材包管理界面（过滤、搜索、标记收藏）。
- **第 10 轮**：加入多地图项目支持与快速切换功能。
- **第 11 轮**：整合键盘快捷键与自定义配置存储。
- **第 12 轮**：添加辅助工具（对齐线、区域选择、填充）。
- **第 13 轮**：优化性能（离屏渲染、虚拟滚动）并增强地图体验。
- **第 14 轮**：提供导出预览与截图分享功能。
- **第 15 轮**：完成文档、单元测试与发布准备。

## 变更日志
- **R2**：完成 Canvas 网格、相机平移/缩放与状态栏联动。
- **R1**：构建基础布局框架与模块化脚手架。
